/*
*
* jQuery Plugin Prototype for ONS Lightweight Charting by Stefan Goodchild
* Triple Geek Ltd
*
*/(function(e,t,n,r){function o(t,n){this.element=t;this.$el=e(t);this.settings=e.extend({},s,n);this.instance={};this._defaults=s;this._name=i;this.init()}var i="onsc",s={breakpoint:640,overBreakpoint:!0};o.prototype={init:function(){this.settings.overBreakpoint=this.overBreakpoint();this.instance.table=this.$el.find("table");var n=this;e(t).resize(function(){n.checkBreakpoint()});this.create()},supported:function(){return!!n.createElementNS&&!!n.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect},overBreakpoint:function(){return e(t).width()>this.settings.breakpoint},checkBreakpoint:function(){if(this.settings.overBreakpoint!=this.overBreakpoint()){this.settings.overBreakpoint=this.overBreakpoint();this.destroy();this.create()}},createSVG:function(){this.instance.rid="ons-rid-"+(Math.random().toString(36)+"00000000000000000").slice(2,7);this.instance.chartWrap=e('<div class="ons-chart-wrap"><svg viewBox="0 0 '+this.settings.base_size.x+" "+this.settings.base_size.y+'" preserveAspectRatio="xMinYMin meet" id="'+this.instance.rid+'"></svg></div>');this.$el.append(this.instance.chartWrap);this.instance.svg=Snap("#"+this.instance.rid)},addWrapperPadding:function(){var e=this.settings.base_size.y/this.settings.base_size.x*100;this.instance.chartWrap.css({"padding-bottom":e+"%"})},destroy:function(){this.instance.chartWrap.remove()},create:function(){if(this.supported()){if(this.$el.hasClass("ons-bar")){this.instance.table.hide();this.barChart()}if(this.$el.hasClass("ons-bar-alt")){this.instance.table.hide();this.barChartAlt()}}},barChart:function(){this.settings.overBreakpoint?this.barChartW():this.barChartN()},barChartAlt:function(){this.settings.overBreakpoint?this.barChartAltW():this.barChartAltN()},barChartW:function(){this.settings.base_size={x:1280,y:720};this.settings.chart_size={x:1280,y:620};this.createSVG();this.addWrapperPadding();var t=this.instance.table.find("th").length,n=this.settings.chart_size.x/100,r=(this.settings.chart_size.x+n)/t;this.instance.svg.line(0,0,this.settings.chart_size.x,0).attr({stroke:"#999999","stroke-dasharray":"3,3"});this.instance.svg.line(0,this.settings.chart_size.y/2,this.settings.chart_size.x,this.settings.chart_size.y/2).attr({stroke:"#999999","stroke-dasharray":"3,3"});this.instance.svg.line(0,this.settings.chart_size.y+2,this.settings.chart_size.x,this.settings.chart_size.y+2).attr({stroke:"#999999","stroke-width":"4"});var i=0,s=this;e.each(this.instance.table.find("td"),function(t,o){var u=parseFloat(e(o).html())/100,a=s.instance.svg.rect(i,s.settings.chart_size.y-s.settings.chart_size.y*u,r-n,s.settings.chart_size.y*u,5);a.attr({fill:"#0088CE"});i+=r});i=0;e.each(this.instance.table.find("th"),function(t,o){var u=s.instance.svg.text(i+r/2-n,s.settings.base_size.y-(s.settings.base_size.y-s.settings.chart_size.y)/1.7,e(o).text());u.attr({"font-size":"25px","text-anchor":"middle",fill:"#666"});i+=r});i=0;e.each(this.instance.table.find("td"),function(t,o){var u=s.instance.svg.text(i+r/2-n,s.settings.base_size.y-(s.settings.base_size.y-s.settings.chart_size.y)/5,e(o).text());u.attr({"font-size":"35px","font-weight":"bold","text-anchor":"middle",fill:"#444"});i+=r})},barChartN:function(){var t=this.instance.table.find("th").length,n=90;this.settings.base_size={x:640,y:n*t};this.settings.chart_size={x:640,y:n*t};this.createSVG();this.addWrapperPadding();var r=0;e.each(this.instance.table.find("td"),function(t,n){var i=parseFloat(e(n).html())/100;i>r&&(r=i)});var i=100/r/100,s=0,o=this;e.each(this.instance.table.find("td"),function(t,r){var u=parseFloat(e(r).html())/100,a=o.instance.svg.rect(0,s,o.settings.chart_size.x*u*i,30,5).attr({fill:"#0088CE"}),f=o.instance.svg.text(0,s+60,e(o.instance.table.find("th")[t]).text()).attr({"font-size":"25px","text-anchor":"left",fill:"#666"}),l=f.getBBox().width,c=o.settings.chart_size.x*u*i;c-l>50?o.instance.svg.text(c,s+60,e(r).text()).attr({"font-size":"25px","font-weight":"bold","text-anchor":"end",fill:"#444"}):o.instance.svg.text(l+15,s+60,e(r).text()).attr({"font-size":"25px","font-weight":"bold","text-anchor":"start",fill:"#444"});s+=n})},barChartAltW:function(){},barChartAltN:function(){var t=this.instance.table.find("th").length,n=50;this.settings.base_size={x:640,y:n*t};this.settings.chart_size={x:640,y:n*t};this.createSVG();this.addWrapperPadding();var r=0,i=0;e.each(this.instance.table.find("td"),function(t,n){var i=parseFloat(e(n).html())/100;i>r&&(r=i)})}};e.fn[i]=function(t){return this.each(function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,new o(this,t))})}})(jQuery,window,document);