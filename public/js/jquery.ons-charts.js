/*
*
* jQuery Plugin Prototype for ONS Lightweight Charting by Stefan Goodchild
* Triple Geek Ltd
*
*/(function(e,t,n,r){function o(t,n){this.element=t;this.$el=e(t);this.settings=e.extend({},s,n);this.instance={};this._defaults=s;this._name=i;this.settings.colours=[];this.settings.colours[0]=["#0084D1"];this.settings.colours[1]=["#0084D1","#FF950E","#A9BE3A","#FFD320"];this.init()}var i="onsc",s={breakpoint:640,overBreakpoint:!0};o.prototype={init:function(){this.settings.overBreakpoint=this.overBreakpoint();this.instance.table=this.$el.find("table");var n=this;e(t).resize(function(){n.checkBreakpoint()});this.supported?e("body").addClass("svg"):e("body").addClass("no-svg");this.create()},supported:function(){return!!n.createElementNS&&!!n.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect},overBreakpoint:function(){return e(t).width()>this.settings.breakpoint},checkBreakpoint:function(){if(this.settings.overBreakpoint!=this.overBreakpoint()){this.settings.overBreakpoint=this.overBreakpoint();this.destroy();this.create()}},createSVG:function(t){this.instance.rid="ons-rid-"+(Math.random().toString(36)+"00000000000000000").slice(2,7);this.instance.chartWrap=e('<div class="ons-chart-wrap"><svg viewBox="0 0 '+this.settings.base_size.x+" "+this.settings.base_size.y+'" preserveAspectRatio="xMinYMin meet" id="'+this.instance.rid+'"></svg></div>');t.after(this.instance.chartWrap);this.instance.svg=Snap("#"+this.instance.rid)},addWrapperPadding:function(){var e=this.settings.base_size.y/this.settings.base_size.x*100;this.instance.chartWrap.css({"padding-bottom":e+"%"})},sanitizeNumber:function(e){return Number(parseFloat(e.replace(/[^0-9\.]+/g,"")))},defineColours:function(e){return e.hasClass("ons-colour")?this.settings.colours[1]:this.settings.colours[0]},destroy:function(){this.$el.find(".ons-chart-wrap").remove()},create:function(){that=this;e.each(this.instance.table,function(t,n){$e=e(n);if(that.supported()){if($e.hasClass("ons-bar")){$e.hide();that.barChart($e)}if($e.hasClass("ons-bar-alt")){$e.hide();that.barChartAlt($e)}}})},barChart:function(e){e.hasClass("ons-horizontal-only")?this.barChartN(e):this.settings.overBreakpoint?this.barChartW(e):this.barChartN(e)},barChartAlt:function(e){this.settings.overBreakpoint?this.barChartAltW(e):this.barChartAltN(e)},barChartW:function(t){this.settings.base_size={x:1280,y:720};this.settings.chart_size={x:1280,y:620};this.createSVG(t);this.addWrapperPadding();var n=t.find("th").length,r=this.settings.chart_size.x/100,i=(this.settings.chart_size.x+r)/n;this.instance.svg.line(0,0,this.settings.chart_size.x,0).attr({stroke:"#999999","stroke-dasharray":"3,3"});this.instance.svg.line(0,this.settings.chart_size.y/2,this.settings.chart_size.x,this.settings.chart_size.y/2).attr({stroke:"#999999","stroke-dasharray":"3,3"});this.instance.svg.line(0,this.settings.chart_size.y+2,this.settings.chart_size.x,this.settings.chart_size.y+2).attr({stroke:"#999999","stroke-width":"4"});var s=0,o=this,u=this.defineColours(t),a=0;e.each(t.find("td"),function(t,n){var f=u[a];a++;a>=u.length&&(a=0);var l=o.sanitizeNumber(e(n).html())/100,c=o.instance.svg.rect(s,o.settings.chart_size.y-o.settings.chart_size.y*l,i-r,o.settings.chart_size.y*l,5);c.attr({fill:f});s+=i});s=0;e.each(t.find("th"),function(t,n){var u=o.instance.svg.text(s+i/2-r,o.settings.base_size.y-(o.settings.base_size.y-o.settings.chart_size.y)/1.7,e(n).text());u.attr({"font-size":"25px","text-anchor":"middle",fill:"#666"});s+=i});s=0;e.each(t.find("td"),function(t,n){var u=o.instance.svg.text(s+i/2-r,o.settings.base_size.y-(o.settings.base_size.y-o.settings.chart_size.y)/5,e(n).text());u.attr({"font-size":"35px","font-weight":"bold","text-anchor":"middle",fill:"#444"});s+=i})},barChartN:function(t){var n=t.find("th").length,r=90;this.settings.base_size={x:640,y:r*n};this.settings.chart_size={x:640,y:r*n};this.createSVG(t);this.addWrapperPadding();var i=0,s=this;e.each(this.instance.table.find("td"),function(t,n){var r=s.sanitizeNumber(e(n).html())/100;r>i&&(i=r)});var o=100/i/100,u=0,s=this,a=this.defineColours(t),f=0;e.each(t.find("td"),function(n,i){var l=a[f];f++;f>=a.length&&(f=0);var c=s.sanitizeNumber(e(i).html());c*=.01;var h=s.instance.svg.rect(0,u,s.settings.chart_size.x*c*o,30,5).attr({fill:l}),p=s.instance.svg.text(0,u+60,e(t.find("th")[n]).text()).attr({"font-size":"25px","text-anchor":"left",fill:"#666"}),d=p.getBBox().width,v=s.settings.chart_size.x*c*o;v-d>50?s.instance.svg.text(v,u+60,e(i).text()).attr({"font-size":"25px","font-weight":"bold","text-anchor":"end",fill:"#444"}):s.instance.svg.text(d+15,u+60,e(i).text()).attr({"font-size":"25px","font-weight":"bold","text-anchor":"start",fill:"#444"});u+=r})},barChartAltW:function(t){var n=t.find("th").length,r=30;this.settings.base_size={x:640,y:r*n+r*2.5};this.createSVG(t);this.addWrapperPadding();var i=0,s=0,o=0,u=this;e.each(t.find("td"),function(n,r){var o=u.sanitizeNumber(e(r).html())/100;o>i&&(i=o);var a=u.instance.svg.text(-100,-100,e(t.find("th")[n]).text());a.getBBox().width>s&&(s=a.getBBox().width);a.remove()});s+=40;this.settings.chart_size={x:640-s,y:r*n+r};var a=Math.round(i*10)/10;for(x=0;x<=1;x+=.25){this.instance.svg.line(s+this.settings.chart_size.x*x,30,s+this.settings.chart_size.x*x,this.settings.chart_size.y).attr({stroke:"#999999","stroke-dasharray":"3,3"});var f=this.settings.chart_size.x*x,l="middle";x==0&&(l="start");x==1&&(l="end");var c=u.instance.svg.text(s+f,23,Math.round(x*a*100)+"%").attr({"font-size":"20px","font-weight":"bold","text-anchor":l,fill:"#939598"}),c=u.instance.svg.text(s+f,this.settings.base_size.y-5,Math.round(x*a*100)+"%").attr({"font-size":"20px","font-weight":"bold","text-anchor":l,fill:"#939598"})}e.each(t.find("td"),function(n,i){var f=u.sanitizeNumber(e(i).html())/a,l="#90B0C9";e(i).hasClass("highlight")&&(l="#FF950E");var c=u.instance.svg.rect(s,o+50,u.settings.chart_size.x*f/100,20,5).attr({fill:l,cursor:"pointer"}),h="#222";n%2==1&&(h="#666");var p=u.instance.svg.text(0,o+67,e(t.find("th")[n]).text()).attr({"font-size":"20px","text-anchor":"left",fill:h});u.hoverLabel(c,u,f,o-17,n,i,s,t);o+=r})},barChartAltN:function(t){var n=t.find("th").length,r=52;this.settings.base_size={x:640,y:r*n+r*1.5};this.settings.chart_size={x:640,y:r*n+r};this.createSVG(t);this.addWrapperPadding();var i=0,s=0,o=0,u=this;e.each(t.find("td"),function(t,n){var r=u.sanitizeNumber(e(n).html())/100;r>i&&(i=r)});var a=Math.round(i*10)/10;for(x=0;x<=1;x+=.25){this.instance.svg.line(this.settings.base_size.x*x,30,this.settings.base_size.x*x,this.settings.chart_size.y).attr({stroke:"#999999","stroke-dasharray":"3,3"});var f=this.settings.base_size.x*x,l="middle";x==0&&(l="start");x==1&&(l="end");var c=u.instance.svg.text(f,23,Math.round(x*a*100)+"%").attr({"font-size":"20px","font-weight":"bold","text-anchor":l,fill:"#939598"}),c=u.instance.svg.text(f,this.settings.base_size.y-5,Math.round(x*a*100)+"%").attr({"font-size":"20px","font-weight":"bold","text-anchor":l,fill:"#939598"})}e.each(t.find("td"),function(n,i){var s=u.sanitizeNumber(e(i).html())/a,f="#90B0C9";e(i).hasClass("highlight")&&(f="#FF950E");var l=u.instance.svg.rect(0,o+67,u.settings.chart_size.x*s/100,20,5).attr({fill:f}),c="#222";n%2==1&&(c="#666");var h=u.instance.svg.text(0,o+60,e(t.find("th")[n]).text()).attr({"font-size":"20px","text-anchor":"left",fill:c});u.hoverLabel(l,u,s,o,n,i,0,t);o+=r})},hoverLabel:function(t,n,r,i,s,o,u,a){var f=n.instance.svg.circle(u+n.settings.chart_size.x*r/100*.5,i+77,12),l=i-27,c=n.instance.svg.line(u+n.settings.chart_size.x*r/100*.5,i+77,u+n.settings.chart_size.x*r/100*.5,l).attr({stroke:"#000",strokeWidth:3,"stroke-dasharray":"0,0"}),h=n.instance.svg.rect(u+n.settings.chart_size.x*.05,l,n.settings.chart_size.x*.9,87,5).attr({fill:"white",stroke:"black",strokeWidth:3}),p=n.instance.svg.text(u+45,l+33,e(a.find("th")[s]).text()).attr({"font-size":"25px","font-weight":"bold","text-anchor":"left",fill:"#333"}),d=n.instance.svg.text(u+45,l+70,e(o).html()).attr({"font-size":"40px","font-weight":"bold","text-anchor":"left",fill:"#333"}),v=n.instance.svg.group(f,c,h,p,d).attr({visibility:"hidden"});v.hover(function(){v.attr({visibility:"visible"})},function(){v.attr({visibility:"hidden"})});t.hover(function(){v.attr({visibility:"visible"})},function(){v.attr({visibility:"hidden"})});return v}};e.fn[i]=function(t){return this.each(function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,new o(this,t))})}})(jQuery,window,document);