/*
*
* jQuery Wrapper Plugin Prototype for ONS Lightweight Charting by Stefan Goodchild
* Triple Geek Ltd
*
*/(function(e){e.fn.onsc=function(){this.instance={};this.settings={};this.settings.breakpoint=640;this.settings.overBreakpoint=!0;var n=function(){return!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect},i=function(){return e(window).width()>this.settings.breakpoint},s=function(t){e(window).resize(function(){d()});this.settings.overBreakpoint=i();this.instance.wrap=e(t);this.instance.table=this.instance.wrap.find("table");o()},o=function(){if(n()&&this.instance.wrap.hasClass("ons-bar")){this.instance.table.hide();this.settings.overBreakpoint?c():h()}},u=function(){this.instance.chartWrap.remove()},a=function(){this.instance.rid="ons-rid-"+(Math.random().toString(36)+"00000000000000000").slice(2,7);this.instance.chartWrap=e('<div class="ons-chart-wrap"><svg viewBox="0 0 '+this.settings.base_size.x+" "+this.settings.base_size.y+'" preserveAspectRatio="xMinYMin meet" id="'+this.instance.rid+'"></svg></div>');this.instance.wrap.append(this.instance.chartWrap);this.instance.svg=Snap("#"+this.instance.rid)},f=function(){this.padding=this.settings.base_size.y/this.settings.base_size.x*100;this.instance.chartWrap.css({"padding-bottom":padding+"%"})},c=function(){this.settings.base_size={x:1280,y:720};this.settings.chart_size={x:1280,y:620};a();f();this.count=this.instance.table.find("th").length;this.spacer=this.settings.chart_size.x/100;this.jump=(this.settings.chart_size.x+spacer)/count;this.instance.svg.line(0,0,this.settings.chart_size.x,0).attr({stroke:"#999999","stroke-dasharray":"3,3"});this.instance.svg.line(0,this.settings.chart_size.y/2,this.settings.chart_size.x,this.settings.chart_size.y/2).attr({stroke:"#999999","stroke-dasharray":"3,3"});this.instance.svg.line(0,this.settings.chart_size.y+2,this.settings.chart_size.x,this.settings.chart_size.y+2).attr({stroke:"#999999","stroke-width":"4"});this.x=0;e.each(this.instance.table.find("td"),function(t,n){this.height=parseFloat(e(n).html())/100;this.r=this.instance.svg.rect(x,this.settings.chart_size.y-this.settings.chart_size.y*height,jump-spacer,this.settings.chart_size.y*height,5);r.attr({fill:"#0088CE"});x+=jump});x=0;e.each(this.instance.table.find("th"),function(n,r){this.t=this.instance.svg.text(x+jump/2-spacer,this.settings.base_size.y-(this.settings.base_size.y-this.settings.chart_size.y)/1.7,e(r).text());t.attr({"font-size":"25px","text-anchor":"middle",fill:"#666"});x+=jump});x=0;e.each(this.instance.table.find("td"),function(n,r){this.t=this.instance.svg.text(x+jump/2-spacer,this.settings.base_size.y-(this.settings.base_size.y-this.settings.chart_size.y)/5,e(r).text());t.attr({"font-size":"35px","font-weight":"bold","text-anchor":"middle",fill:"#444"});x+=jump})},h=function(){this.count=this.instance.table.find("th").length;this.jump=90;this.settings.base_size={x:640,y:jump*count};this.settings.chart_size={x:640,y:jump*count};a();f();this.maxwidth=0;e.each(this.instance.table.find("td"),function(t,n){this.newWidth=parseFloat(e(n).html())/100;newWidth>maxwidth&&(maxwidth=newWidth)});this.widthMult=100/maxwidth/100;this.y=0;e.each(this.instance.table.find("td"),function(t,n){this.width=parseFloat(e(n).html())/100;this.b=this.instance.svg.rect(0,y,this.settings.chart_size.x*width*widthMult,30,5).attr({fill:"#0088CE"});this.l=this.instance.svg.text(0,y+60,e(this.instance.table.find("th")[t]).text()).attr({"font-size":"25px","text-anchor":"left",fill:"#666"});this.labelWidth=l.getBBox().width;this.barWidth=this.settings.chart_size.x*width*widthMult;barWidth-labelWidth>50?this.instance.svg.text(barWidth,y+60,e(n).text()).attr({"font-size":"25px","font-weight":"bold","text-anchor":"end",fill:"#444"}):this.instance.svg.text(labelWidth+15,y+60,e(n).text()).attr({"font-size":"25px","font-weight":"bold","text-anchor":"start",fill:"#444"});y+=jump})},p=function(){this.instance.svg.circle(0,0,50);this.instance.svg.circle(this.settings.base_size.x,0,50);this.instance.svg.circle(this.settings.base_size.x/2,this.settings.base_size.y/2,50);this.instance.svg.circle(this.settings.base_size.x,this.settings.base_size.y,50);this.instance.svg.circle(0,this.settings.base_size.y,50)},d=function(){if(this.settings.overBreakpoint!=i()){this.settings.overBreakpoint=i();u();o()}};return this.each(function(){s(this)})}})(jQuery);